# Git Operations GraphQL Schema
# This service handles all Git-related operations for the metaGOTHIC framework

type Query {
  """Get the current git status of a repository"""
  gitStatus(path: String!): GitStatus!
  
  """Scan workspace for all git repositories"""
  scanAllRepositories: [RepositoryScan!]!
  
  """Perform a detailed scan with diffs and history"""
  scanAllDetailed: DetailedScanReport!
  
  """List and get status of git submodules"""
  submodules: [Submodule!]!
  
  """Get comprehensive information about a specific repository"""
  repositoryDetails(path: String!): RepositoryDetails!
}

type Mutation {
  """Execute a git command (with safety restrictions)"""
  executeGitCommand(input: GitCommandInput!): GitCommandResult!
  
  """Stage and commit changes"""
  commitChanges(input: CommitInput!): CommitResult!
  
  """Commit changes across multiple repositories"""
  batchCommit(input: BatchCommitInput!): BatchCommitResult!
  
  """Push changes to remote repository"""
  pushChanges(input: PushInput!): PushResult!
}

# Types

type GitStatus {
  """Current branch name"""
  branch: String!
  
  """Whether there are uncommitted changes"""
  isDirty: Boolean!
  
  """List of files with changes"""
  files: [FileStatus!]!
  
  """Number of commits ahead of remote"""
  ahead: Int!
  
  """Number of commits behind remote"""
  behind: Int!
  
  """Whether repository has a remote"""
  hasRemote: Boolean!
  
  """List of stashes"""
  stashes: [Stash!]!
}

type FileStatus {
  """File path relative to repository root"""
  path: String!
  
  """Git status code (M, A, D, R, U, etc.)"""
  status: String!
  
  """Human-readable status description"""
  statusDescription: String!
  
  """Whether file is staged"""
  isStaged: Boolean!
}

type Stash {
  """Stash index"""
  index: Int!
  
  """Stash message"""
  message: String!
  
  """When the stash was created"""
  timestamp: String!
}

type RepositoryScan {
  """Repository name"""
  name: String!
  
  """Absolute path to repository"""
  path: String!
  
  """Whether repository has uncommitted changes"""
  isDirty: Boolean!
  
  """Current branch"""
  branch: String!
  
  """Number of uncommitted files"""
  uncommittedCount: Int!
  
  """Repository type (regular, submodule, etc.)"""
  type: RepositoryType!
}

type DetailedScanReport {
  """List of all repositories with detailed information"""
  repositories: [DetailedRepository!]!
  
  """Overall statistics"""
  statistics: ScanStatistics!
  
  """Scan metadata"""
  metadata: ScanMetadata!
}

type DetailedRepository {
  """Repository name"""
  name: String!
  
  """Absolute path"""
  path: String!
  
  """Git status information"""
  status: GitStatus!
  
  """Staged diff"""
  stagedDiff: String
  
  """Unstaged diff"""
  unstagedDiff: String
  
  """Recent commit history"""
  recentCommits: [Commit!]!
  
  """Remote information"""
  remotes: [Remote!]!
  
  """Repository configuration"""
  config: RepositoryConfig!
}

type Commit {
  """Commit hash"""
  hash: String!
  
  """Commit message"""
  message: String!
  
  """Author name"""
  author: String!
  
  """Author email"""
  authorEmail: String!
  
  """Commit timestamp"""
  timestamp: String!
}

type Remote {
  """Remote name (e.g., origin)"""
  name: String!
  
  """Fetch URL"""
  fetchUrl: String!
  
  """Push URL"""
  pushUrl: String!
}

type RepositoryConfig {
  """Default branch name"""
  defaultBranch: String!
  
  """Whether repository is bare"""
  isBare: Boolean!
  
  """Whether repository is shallow"""
  isShallow: Boolean!
}

type ScanStatistics {
  """Total number of repositories"""
  totalRepositories: Int!
  
  """Number of dirty repositories"""
  dirtyRepositories: Int!
  
  """Total uncommitted files"""
  totalUncommittedFiles: Int!
  
  """Total lines added"""
  totalAdditions: Int!
  
  """Total lines deleted"""
  totalDeletions: Int!
  
  """Breakdown by file type"""
  changesByType: ChangesByType!
}

type ChangesByType {
  """Modified files"""
  modified: Int!
  
  """Added files"""
  added: Int!
  
  """Deleted files"""
  deleted: Int!
  
  """Renamed files"""
  renamed: Int!
  
  """Untracked files"""
  untracked: Int!
}

type ScanMetadata {
  """When the scan started"""
  startTime: String!
  
  """When the scan completed"""
  endTime: String!
  
  """Scan duration in milliseconds"""
  duration: Int!
  
  """Workspace root path"""
  workspaceRoot: String!
}

type Submodule {
  """Submodule name"""
  name: String!
  
  """Path relative to parent repository"""
  path: String!
  
  """Current commit hash"""
  commit: String!
  
  """Submodule URL"""
  url: String!
  
  """Whether submodule is initialized"""
  isInitialized: Boolean!
  
  """Whether submodule has uncommitted changes"""
  isDirty: Boolean!
  
  """Submodule status"""
  status: SubmoduleStatus!
}

type SubmoduleStatus {
  """Whether submodule is up to date"""
  isUpToDate: Boolean!
  
  """Number of commits ahead"""
  ahead: Int!
  
  """Number of commits behind"""
  behind: Int!
  
  """Whether submodule has merge conflicts"""
  hasConflicts: Boolean!
}

type RepositoryDetails {
  """Repository name"""
  name: String!
  
  """Absolute path"""
  path: String!
  
  """Full git status"""
  status: GitStatus!
  
  """All branches"""
  branches: [Branch!]!
  
  """All tags"""
  tags: [Tag!]!
  
  """All remotes"""
  remotes: [Remote!]!
  
  """Repository size information"""
  size: RepositorySize!
  
  """Package information if applicable"""
  packageInfo: PackageInfo
}

type Branch {
  """Branch name"""
  name: String!
  
  """Whether this is the current branch"""
  isCurrent: Boolean!
  
  """Whether branch tracks a remote"""
  isTracking: Boolean!
  
  """Remote tracking branch"""
  trackingBranch: String
  
  """Last commit on branch"""
  lastCommit: Commit!
}

type Tag {
  """Tag name"""
  name: String!
  
  """Tag type (lightweight or annotated)"""
  type: TagType!
  
  """Tagged commit"""
  commit: String!
  
  """Tag message (for annotated tags)"""
  message: String
  
  """Tagger information"""
  tagger: String
  
  """Tag date"""
  date: String
}

type RepositorySize {
  """Total size in bytes"""
  totalSize: Int!
  
  """Number of files"""
  fileCount: Int!
  
  """Number of commits"""
  commitCount: Int!
  
  """Size of .git directory"""
  gitSize: Int!
}

type PackageInfo {
  """Package name from package.json"""
  name: String!
  
  """Package version"""
  version: String!
  
  """Package description"""
  description: String
  
  """Main entry point"""
  main: String
  
  """Scripts available"""
  scripts: [String!]!
  
  """Dependencies count"""
  dependencyCount: Int!
  
  """Dev dependencies count"""
  devDependencyCount: Int!
}

type GitCommandResult {
  """Whether command executed successfully"""
  success: Boolean!
  
  """Command output"""
  output: String
  
  """Error message if failed"""
  error: String
  
  """Exit code"""
  exitCode: Int!
  
  """Command that was executed"""
  command: String!
}

type CommitResult {
  """Whether commit was successful"""
  success: Boolean!
  
  """Commit hash"""
  commitHash: String
  
  """Error message if failed"""
  error: String
  
  """Repository path"""
  repository: String!
  
  """Files that were committed"""
  committedFiles: [String!]!
}

type BatchCommitResult {
  """Total repositories processed"""
  totalRepositories: Int!
  
  """Number of successful commits"""
  successCount: Int!
  
  """Individual results per repository"""
  results: [CommitResult!]!
  
  """Execution time in milliseconds"""
  executionTime: Int!
}

type PushResult {
  """Whether push was successful"""
  success: Boolean!
  
  """Remote name"""
  remote: String!
  
  """Branch that was pushed"""
  branch: String!
  
  """Error message if failed"""
  error: String
  
  """Repository path"""
  repository: String!
}

# Enums

enum RepositoryType {
  """Regular git repository"""
  REGULAR
  
  """Git submodule"""
  SUBMODULE
  
  """Bare repository"""
  BARE
  
  """Worktree"""
  WORKTREE
}

enum TagType {
  """Lightweight tag"""
  LIGHTWEIGHT
  
  """Annotated tag"""
  ANNOTATED
}

# Input Types

input GitCommandInput {
  """Repository path"""
  repository: String!
  
  """Git command to execute (without 'git' prefix)"""
  command: String!
  
  """Command arguments"""
  args: [String!]!
  
  """Working directory (defaults to repository path)"""
  workingDirectory: String
}

input CommitInput {
  """Repository path"""
  repository: String!
  
  """Commit message"""
  message: String!
  
  """Files to stage (empty means all)"""
  files: [String!]
  
  """Whether to stage all changes"""
  stageAll: Boolean
  
  """Author name (optional)"""
  author: String
  
  """Author email (optional)"""
  authorEmail: String
}

input BatchCommitInput {
  """List of commits to perform"""
  commits: [CommitInput!]!
  
  """Whether to continue on error"""
  continueOnError: Boolean
  
  """Maximum parallel operations"""
  maxConcurrency: Int
}

input PushInput {
  """Repository path"""
  repository: String!
  
  """Remote name (defaults to origin)"""
  remote: String
  
  """Branch to push (defaults to current)"""
  branch: String
  
  """Whether to set upstream"""
  setUpstream: Boolean
  
  """Whether to push tags"""
  pushTags: Boolean
}